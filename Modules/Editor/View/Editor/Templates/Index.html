<?php
/**
* 	
*/

# Define namespace
namespace WCFE\Modules\Editor\View\Editor\Templates;

# No direct access
defined('ABSPATH') or die(WCFE\NO_DIRECT_ACCESS_MESSAGE);
	
# Getting model
$model =& $this->result();
$form =& $model->getForm();
$router =& $this->router();
$serviceRouter = $router->findRouter( 'Editor', 'editorService' );

# Actions Routes used by variaous aajax requests
$actionsRoutes = array();

$actionsToGetRoute = array
(
	'createSecureKey',
	'preUpdate',
	'validateForm',
	'postUpdate',
	'updateConfigFile',
);

foreach ( $actionsToGetRoute as $actionName )
{
	$actionsRoutes[ $actionName ] = (string) $serviceRouter->routeAction( $actionName );
}

?>
<div id="wcfe-body">
<?php if ($model->hasErrors()) : ?>
	<ul id="errors-bar">
<?php foreach ($model->getCleanErrors() as $errorMessage) : ?>
		<li><?php echo $errorMessage; ?></li>
<?php endforeach; ?>
	</ul>
<?php $model->writeState(); # Re-write state as this is running too late! ?>
<?php endif; ?>
	<form id="wcfe-config-editor-form" method="post" action="<?php echo $router->routeAction() ?>">
<?php
		# Output options tab
		$optionsTab = new	Tabs\Tabs( $form );
		echo $optionsTab;
?>
		<div id="wcfe-toolbox">
			<input type="button" value="Save" id="wcfe-editor-form-save" />
			<input type="button" value="Preview" id="wcfe-editor-form-preview" />
			<input type="hidden" name="configFileFields[Task]" value="" />
		</div>
		<input type="hidden" name="configFileFields[<?php echo $form->getSecurityTokenName(); ?>]" value="<?php echo $form->getSecurityToken()->getValue(); ?>" />
	</form>
</div>
<script type="text/javascript">var actionsRoute = <?php echo json_encode( $actionsRoutes ) ?>;</script>

<?php // Errors list dialog to be used by various Ajax actions ?>
<div id="wcfe-errors-dialog"><div><ul id="wcfe-errors-dialog-errors-list"></ul></div></div>

<?php // Confirm save message template to be used by thickbox as inline popup ?>
<?php require 'ConfirmSave.html'; ?>